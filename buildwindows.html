<!-- HTML header for doxygen 1.10.0-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.10.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Mario Kart 64: Compiling for Windows</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="doxygen-awesome.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only.css" rel="stylesheet" type="text/css"/>
<link href="doxygen-awesome-sidebar-only-darkmode-toggle.css" rel="stylesheet" type="text/css"/>
<link href="docs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="doxygen-awesome-darkmode-toggle.js"></script>
<script type="text/javascript">
    DoxygenAwesomeDarkModeToggle.init()
</script>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Mario Kart 64
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.10.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('buildwindows.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Compiling for Windows</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2><a class="anchor" id="compiling-mk64-decomp-in-windows"></a>
Compiling mk64 Decomp In Windows</h2>
<p><em><b>This method is not recommended nor supported. However, it is the only solution to build in W7/W8. WSL is the path of least resistance, use that not this</b></em></p>
<blockquote class="doxtable">
<p>&zwj;Building decomp using msys on Windows is a journey.. A journey akin to crawling over broken glass in the dark. </p>
</blockquote>
<p>- leogames</p>
<p>The extraneous and convoluted process to building mk64 decomp on Windows begins with disabling your anti-virus program or adding an exception to the mk64 decomp folder and the msys2 installation folder. Please note that this action may impact the security of your system. Prior to proceeding, make sure to understand the increased security risks that may result from this step. Nobody except you, is responsible and liable for your system and its security.</p>
<h3><a class="anchor" id="preamble"></a>
Preamble</h3>
<p>Any misteps may require a complete uninstall of <code>MSYS2 MinGW x64</code> and restarting from the very beginning. <br  />
 It is unknown if <code>MSYS MinGW x32</code> is supported (most likely not).</p>
<h3><a class="anchor" id="step-1-download-msys2-mingw-x64"></a>
Step 1: Download MSYS2 MinGW x64</h3>
<p><a href="https://www.msys2.org/">https://www.msys2.org/</a></p>
<p>Follow the initial instructions to update the base packages. Ignore installing any extra packages in-case they conflict with the below steps.</p>
<p>MinGW is a separate program from Msys2. However, it must be wrapped right into msys2. Compiling recomp requires steps using&lt;br&gt;<code>MSYS2 MSYS</code> <em>and</em> <code>MSYS2 MinGW x64</code>. The instructions will clearly differentiate which terminal program to launch and run in the section titles.</p>
<p><a class="anchor" id="why-flip-flop-between-both"></a> </p><h5><em>Why flip-flop between both?</em></h5>
<p>Compiling the recomp executable that generates the source files for compiling the compiler requires capstone. A disassembly, analysis, and reverse-engineering framework. Capstone is only available on <code>MSYS2 MinGW x64</code>. It is not available on <code>MSYS2 MSYS</code>. However, compiling the compiler itself requires <code>MSYS2 MSYS</code> because it contains an equivallent dependency for <code>mman</code>. A memory mapping library. <code>MSYS2 MinGW x64</code> does not contain an equivallent dependancy.</p>
<h3><a class="anchor" id="step-2-install-dependancies-in-msys2-mingw-x64"></a>
Step 2: Install Dependancies in MSYS2 MinGW x64</h3>
<div class="fragment"><div class="line">pacman -S mingw-w64-x86_64-gcc mingw-w64-x86_64-capstone pkgconf make python3 git</div>
</div><!-- fragment --><h3><a class="anchor" id="step-3-install-dependencies-in-msys2-msys"></a>
Step 3: Install Dependencies in MSYS2 MSYS</h3>
<div class="fragment"><div class="line">pacman -S gcc</div>
</div><!-- fragment --><h3><a class="anchor" id="step-35-rename-include-in-recompcpp"></a>
Step 3.5: Rename include in recomp.cpp</h3>
<p>For some reason on Windows capstone is inside of a capstone folder. </p><div class="fragment"><div class="line">#include &lt;capstone/capstone.h&gt;</div>
</div><!-- fragment --><h3><a class="anchor" id="step-4-get-binutils"></a>
Step 4: Get Binutils</h3>
<p>Download and install the mips64 tool chain: <br  />
 <a href="https://github.com/N64-tools/mips64-gcc-toolchain">https://github.com/N64-tools/mips64-gcc-toolchain</a></p>
<p>Merge the inner folders (bin, share, etc.) with the respective folders in <code>C:\msys64\mingw64\</code></p>
<h3><a class="anchor" id="step-5-compiling-recompexe-in-msys2-mingw-x64"></a>
Step 5: Compiling recomp.exe in MSYS2 MinGW x64</h3>
<p>In <code>MSYS2 MinGW x64</code> run in <code>mk64/tools/ido5.3_recomp/</code>: </p><div class="fragment"><div class="line">g++ recomp.cpp -o recomp -g -lcapstone -Dugen53</div>
</div><!-- fragment --><h3><a class="anchor" id="step-6-generate-recomp-source-files-in-msys2-mingw-x64"></a>
Step 6: Generate Recomp Source Files in MSYS2 MinGW x64</h3>
<p>Generate the .c files which will compile into the recomp binaries. mk64 requires the following compiler binaries: <code>as1, cc, cfe, copt, ugen, ujoin, uld, umerge, uopt</code></p>
<p>In <code>MSYS2 MinGW x64</code> run in the directory <code>mk64/tools/ido5.3_recomp/</code>: </p><div class="fragment"><div class="line">./recomp ../ido5.3_compiler/usr/lib/as1 &gt; as1_c.c</div>
<div class="line">./recomp ../ido5.3_compiler/usr/lib/cc &gt; cc_c.c</div>
<div class="line">./recomp ../ido5.3_compiler/usr/lib/cfe &gt; cfe_c.c</div>
<div class="line">./recomp ../ido5.3_compiler/usr/lib/copt &gt; copt_c.c</div>
<div class="line">./recomp ../ido5.3_compiler/usr/lib/ugen &gt; ugen_c.c</div>
<div class="line">./recomp ../ido5.3_compiler/usr/lib/ujoin &gt; ujoin_c.c</div>
<div class="line">./recomp ../ido5.3_compiler/usr/lib/uld &gt; uld_c.c</div>
<div class="line">./recomp ../ido5.3_compiler/usr/lib/umerge &gt; umerge_c.c</div>
<div class="line">./recomp ../ido5.3_compiler/usr/lib/uopt &gt; uopt_c.c</div>
</div><!-- fragment --><p> If you get an assertion failed error. Then the directory to the compiler is incorrect. The binary for cc is in <code>/ido5.3_compiler/usr/bin/</code> so do: </p><div class="fragment"><div class="line">./recomp ../ido5.3_compiler/usr/bin/cc &gt; cc_c.c</div>
</div><!-- fragment --> <h3><a class="anchor" id="step-7-compiling-the-recomp-compiler-in-msys2-msys"></a>
Step 7: Compiling the recomp compiler in MSYS2 MSYS</h3>
<p>In <code>MSYS2 MSYS</code> run in the directory <code>mk64/tools/ido5.3_recomp/</code>: </p><div class="fragment"><div class="line">gcc libc_impl.c as1_c.c -o as1 -g -fno-strict-aliasing -lm -no-pie -DIDO53 -O2</div>
<div class="line">gcc libc_impl.c cc_c.c -o cc -g -fno-strict-aliasing -lm -no-pie -DIDO53 -O2</div>
<div class="line">gcc libc_impl.c cfe_c.c -o cfe -g -fno-strict-aliasing -lm -no-pie -DIDO53 -O2</div>
<div class="line">gcc libc_impl.c copt_c.c -o copt -g -fno-strict-aliasing -lm -no-pie -DIDO53 -O2</div>
<div class="line">gcc libc_impl.c ugen_c.c -o ugen -g -fno-strict-aliasing -lm -no-pie -DIDO53 -O2</div>
<div class="line">gcc libc_impl.c ujoin_c.c -o ujoin -g -fno-strict-aliasing -lm -no-pie -DIDO53 -O2</div>
<div class="line">gcc libc_impl.c uld_c.c -o uld -g -fno-strict-aliasing -lm -no-pie -DIDO53 -O2</div>
<div class="line">gcc libc_impl.c umerge_c.c -o umerge -g -fno-strict-aliasing -lm -no-pie -DIDO53 -O2</div>
<div class="line">gcc libc_impl.c uopt_c.c -o uopt -g -fno-strict-aliasing -lm -no-pie -DIDO53 -O2</div>
</div><!-- fragment --><p> <code>-O2</code> is an optional optimization flag. <br  />
</p>
<h3><a class="anchor" id="step-8-compile-mk64-in-msys2-mingw-x64"></a>
Step 8: Compile mk64 in MSYS2 MinGW x64</h3>
<p>In <code>/mk64/</code> run: </p><div class="fragment"><div class="line">make -j#</div>
</div><!-- fragment --><p> Replace # with your number of CPU cores for quicker compilation. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="navelem"><a class="el" href="basics.html">Understanding the Basics</a></li>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.10.0 </li>
  </ul>
</div>
</body>
</html>
